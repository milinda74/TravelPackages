<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${tourPackage.name} + ' - Sri Lanka Travel Promise'">Tour Package Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .page-header {
        background: linear-gradient(135deg, #1a5276 0%, #3498db 100%);
        color: white;
    }
    .tour-image {
        height: 400px;
        object-fit: cover;
        width: 100%;
        border-radius: 10px;
    }
    .highlight-card {
        border-left: 4px solid #0d6efd;
        padding-left: 15px;
    }
    .booking-card {
        position: sticky;
        top: 20px;
    }
    .included-item {
        color: #198754;
    }
    .excluded-item {
        color: #dc3545;
    }
  </style>
</head>
<body>
<!-- Navigation Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand fw-bold text-primary" th:href="@{/}">
      <i class="fas fa-map-marked-alt me-2"></i>Sri Lanka Travel Promise
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" th:href="@{/}">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/destinations}">Destinations</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" th:href="@{/tour-packages}">Tours</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/about}">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/contact}">Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/login}">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/register}">Register</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Page Header -->
<section class="page-header py-5">
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <h1 class="display-4 fw-bold" th:text="${tourPackage.name}">Tour Package Name</h1>
        <p class="lead" th:text="${tourPackage.destination != null ? 'Exploring ' + tourPackage.destination.name : 'Sri Lankan Adventure'}"></p>
      </div>
    </div>
  </div>
</section>

<!-- Tour Package Details -->
<section class="tour-details py-5">
  <div class="container">
    <div class="row">
      <!-- Main Content -->
      <div class="col-lg-8">
        <!-- Tour Image -->
        <div class="mb-4">
          <img th:src="${tourPackage.imageUrl != null ? tourPackage.imageUrl : '/images/default-tour.jpg'}"
               class="tour-image"
               alt="Tour Package Image"
               onerror="this.src='data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22800%22%20height%3D%22400%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20800%20400%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_17a5c4a7ef6%20text%20%7B%20fill%3A%23AAAAAA%3Bfont-weight%3Abold%3Bfont-family%3AArial%2C%20Helvetica%2C%20Open%20Sans%2C%20sans-serif%2C%20monospace%3Bfont-size%3A15pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_17a5c4a7ef6%22%3E%3Crect%20width%3D%22800%22%20height%3D%22400%22%20fill%3D%22%23F5F5F5%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22300%22%20y%3D%22220%22%3EImage%20Not%20Available%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E'">
        </div>

        <!-- Description -->
        <div class="card mb-4">
          <div class="card-body">
            <h3 class="card-title">About This Tour</h3>
            <p class="card-text" th:text="${tourPackage.description}">
              Tour description will appear here...
            </p>
          </div>
        </div>

        <!-- What's Included -->
        <div class="card mb-4">
          <div class="card-body">
            <h3 class="card-title">What's Included</h3>
            <div class="row">
              <div class="col-md-6">
                <h5 class="text-success"><i class="fas fa-check-circle me-2"></i>Included</h5>
                <ul class="list-unstyled">
                  <!-- FIXED: Safe handling of included collection -->
                  <li th:if="${tourPackage.included != null and !tourPackage.included.isEmpty()}">
                    <div th:each="item : ${tourPackage.included}" class="included-item">
                      <i class="fas fa-check me-2"></i><span th:text="${item}"></span>
                    </div>
                  </li>
                  <li th:if="${tourPackage.included == null or tourPackage.included.isEmpty()}" class="text-muted">
                    <i class="fas fa-info-circle me-2"></i>No inclusions specified
                  </li>
                </ul>
              </div>
              <div class="col-md-6">
                <h5 class="text-danger"><i class="fas fa-times-circle me-2"></i>Not Included</h5>
                <ul class="list-unstyled">
                  <!-- FIXED: Safe handling of notIncluded collection -->
                  <li th:if="${tourPackage.notIncluded != null and !tourPackage.notIncluded.isEmpty()}">
                    <div th:each="item : ${tourPackage.notIncluded}" class="excluded-item">
                      <i class="fas fa-times me-2"></i><span th:text="${item}"></span>
                    </div>
                  </li>
                  <li th:if="${tourPackage.notIncluded == null or tourPackage.notIncluded.isEmpty()}" class="text-muted">
                    <i class="fas fa-info-circle me-2"></i>No exclusions specified
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Booking Sidebar -->
      <div class="col-lg-4">
        <div class="card booking-card">
          <div class="card-body">
            <h4 class="card-title text-primary" th:text="'$' + ${tourPackage.price}"></h4>

            <!-- Tour Info -->
            <div class="mb-3">
              <div class="d-flex justify-content-between mb-2">
                <span><i class="fas fa-clock me-2"></i>Duration:</span>
                <span th:text="${tourPackage.duration} + ' days'"></span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span><i class="fas fa-mountain me-2"></i>Difficulty:</span>
                <span class="badge bg-secondary" th:text="${tourPackage.difficulty != null ? tourPackage.difficulty : 'Not specified'}"></span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span><i class="fas fa-users me-2"></i>Group Size:</span>
                <span th:text="${tourPackage.maxTravelers != null ? tourPackage.maxTravelers + ' people' : 'Flexible'}"></span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span><i class="fas fa-map-marker-alt me-2"></i>Destination:</span>
                <span th:text="${tourPackage.destination != null ? tourPackage.destination.name : 'Multiple locations'}"></span>
              </div>
              <!-- FIXED: Safe handling of available spots -->
              <div class="d-flex justify-content-between mb-2" th:if="${tourPackage.maxTravelers != null}">
                <span><i class="fas fa-ticket-alt me-2"></i>Available Spots:</span>
                <span th:text="${tourPackage.getAvailableSpots() != null ? tourPackage.getAvailableSpots() : 'Unlimited'}"></span>
              </div>
            </div>

            <!-- Availability Status -->
            <!-- FIXED: Use method call with safe navigation -->
            <div class="alert" th:classappend="${tourPackage.isAvailable()} ? 'alert-success' : 'alert-danger'" role="alert">
              <span th:if="${tourPackage.isAvailable()}">
                <i class="fas fa-check-circle me-2"></i>Available for booking
              </span>
              <span th:unless="${tourPackage.isAvailable()}">
                <i class="fas fa-times-circle me-2"></i>Currently not available
              </span>
            </div>

            <!-- Booking Button -->
            <!-- FIXED: Use method call with safe navigation -->
            <button th:if="${tourPackage.isAvailable()}" class="btn btn-primary btn-lg w-100 mb-3"
                    data-bs-toggle="modal" data-bs-target="#bookingModal">
              <i class="fas fa-calendar-check me-2"></i>Book Now
            </button>
            <button th:unless="${tourPackage.isAvailable()}" class="btn btn-secondary btn-lg w-100 mb-3" disabled>
              <i class="fas fa-clock me-2"></i>Check Back Later
            </button>

            <!-- Contact Info -->
            <div class="text-center">
              <p class="text-muted">Need help? <a th:href="@{/contact}">Contact us</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-dark text-white py-4 mt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-4 mb-4 mb-md-0">
        <h5>Sri Lanka Travel Promise</h5>
        <p>Your gateway to discovering the beautiful island of Sri Lanka.</p>
      </div>
      <div class="col-md-2 mb-4 mb-md-0">
        <h5>Quick Links</h5>
        <ul class="list-unstyled">
          <li><a href="/destinations" class="text-white text-decoration-none">Destinations</a></li>
          <li><a href="/tour-packages" class="text-white text-decoration-none">Tour Packages</a></li>
          <li><a href="/about" class="text-white text-decoration-none">About Us</a></li>
          <li><a href="/contact" class="text-white text-decoration-none">Contact</a></li>
        </ul>
      </div>
      <div class="col-md-3 mb-4 mb-md-0">
        <h5>Contact Info</h5>
        <ul class="list-unstyled">
          <li><i class="fas fa-map-marker-alt me-2"></i> 123 Galle Road, Colombo</li>
          <li><i class="fas fa-phone me-2"></i> +94 11 234 5678</li>
          <li><i class="fas fa-envelope me-2"></i> info@srilankatravel.com</li>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Follow Us</h5>
        <div class="social-links">
          <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
          <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
          <a href="#" class="text-white"><i class="fab fa-pinterest"></i></a>
        </div>
      </div>
    </div>
    <hr class="my-4">
    <div class="text-center">
      <p class="mb-0">&copy; 2023 Sri Lanka Travel Promise. All rights reserved.</p>
    </div>
  </div>
</footer>

<!-- Booking Modal (Placeholder) -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Book This Tour</h5>
        <button type="button" class="btn-close" data-bs-toggle="modal" data-bs-target="#bookingModal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Booking functionality will be implemented here.</p>
        <p>Please <a th:href="@{/contact}">contact us</a> for booking inquiries.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Proceed to Booking</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>